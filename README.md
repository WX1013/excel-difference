# Excel 差异校验工具

简洁的本地工具，用于比对 Excel 表格中“合计价格”与其下明细行价格之和，支持合并单元格的合计行为：

- 自动识别表头并根据用户配置的列名进行校验
- 支持按“合计价格列”分组（包括合并单元格的合并区域）
- 对不一致的分组，在指定的“标记列”单元格上标黄色，并可下载标注后的 Excel 文件

---

## 功能概览

- 列名称配置（第一步）：
	- `标记黄色列名称`：当合计与明细之和不一致时，会把该列对应的单元格标为黄色（默认 `序号`）。
	- `合计价格列名称`：填写 Excel 中表示组内合计的列名（用于分组，默认 `合计价格`）。
	- `明细价格列名称`：填写明细行的价格列名（用于求和，默认 `价格`）。
	- 如果任一配置的列名在 Excel 表头中找不到，页面会提示具体哪个列匹配不上；请先修正列名再上传文件。

- 上传与校验（第二步）：
	- 上传 Excel 文件（.xlsx / .xls），点击“开始校验并下载”。
	- 程序会解析第一个工作表：按 `合计价格列` 的合并区域或单行进行分组，计算每组内 `明细价格列` 的求和并与合计值比较。
	- 若差异 >= ¥0.01（按分为单位比较），则将该组所有行的配置 `标记列` 单元格标成黄色，并在校验结束后提供一个包含标注的下载文件。

---

## 使用说明（本地开发）

前提：已安装 Node.js 和 npm。

1. 安装依赖：

```bash
npm install
```

2. 启动开发服务器（热重载）：

```bash
npm run dev
```

3. 打包（生产）：

```bash
npm run build
npm run preview
```

默认本地预览端口为 5173（若被占用，Vite 会尝试其它端口，控制台会显示实际端口）。

---

## 开发实现要点

- 入口文件：`src/ExcelValidator.vue`，页面包含两步交互（列名配置 + 上传校验）。
- 使用 `exceljs` 解析与修改 Excel 文件，使用 `file-saver` 提供下载。
- 对合并单元格的处理采用 worksheet 的 `_merges` 信息来确定合并区域并按组计算。
- 标注黄色使用 ExcelJS 的 `cell.fill` 设置为纯黄色背景（ARGB `FFFFFF00`）。

---

## 常见问题

- 如果出现 TypeScript 关于 `file-saver` 的声明文件警告：

```bash
npm i --save-dev @types/file-saver
```

或者在项目中添加一个声明文件（例如 `src/shims-file-saver.d.ts`）：

```ts
declare module 'file-saver';
```

- 若希望更严格地匹配表头（例如忽略前后空格或大小写），可以在 `src/ExcelValidator.vue` 中调整头名称比较逻辑。

---

## 贡献与许可

欢迎提交 issue / PR。此仓库默认无特殊许可，请在协作前约定许可条款。

---

如果需要我把 README 翻成英文版或增加示例截图，我可以继续补充。

